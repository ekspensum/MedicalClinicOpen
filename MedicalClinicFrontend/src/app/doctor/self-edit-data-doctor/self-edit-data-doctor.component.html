<div class="col-md-8">
    <form #selfUpdateForm="ngForm" (ngSubmit)="checkUsernameAndUpdate()" novalidate *ngIf="doctor && answer.visableForm">
        <div class="form-group">
            <label for="username">Login/email</label>
            <input [(ngModel)]="doctor.user.username" [pattern]="patterns.login" type="text" name="username" id="username" 
            class="form-control form-control-sm" required #username="ngModel" [class.is-invalid]="username.invalid && username.touched">
            <small class="text-danger" [class.d-none]="username.valid || username.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
            <label for="password1">{{translate.login.password}}</label>
            <input [(ngModel)]="doctor.user.passwordField" [pattern]="patterns.password" type="password" name="password1" id="password1" 
            class="form-control form-control-sm" required #password1="ngModel" [class.is-invalid]="password1.invalid && password1.touched">
            <small class="text-danger" [class.d-none]="password1.valid || password1.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
            <label for="password2">{{translate.login.passwordRepet}}</label>
            <input [(ngModel)]="passwordRepet" [pattern]="patterns.password" type="password" name="password2" id="password2" 
            class="form-control form-control-sm" required #password2="ngModel" 
            [class.is-invalid]="password2.invalid && password2.touched && password1 != password2">
            <small class="text-danger" [class.d-none]="password2.valid || password2.untouched">{{translate.error.requiredField}}</small>
            <small class="text-danger" [class.d-none]="password1.value == password2.value">{{translate.error.differentPasswords}}</small>
        </div>
        <div class="form-group">
            <label for="firstName">{{translate.user.firstName}}</label>
            <input [(ngModel)]="doctor.user.firstName" [pattern]="patterns.name" type="text" name="firstName" id="firstName" 
            class="form-control form-control-sm" required #firstName="ngModel" [class.is-invalid]="firstName.invalid && firstName.touched">
            <small class="text-danger" [class.d-none]="firstName.valid || firstName.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
            <label for="lastName">{{translate.user.lastName}}</label>
            <input [(ngModel)]="doctor.user.lastName" [pattern]="patterns.name" type="text" name="lastName" id="lastName" 
            class="form-control form-control-sm" required #lastName="ngModel" [class.is-invalid]="lastName.invalid && lastName.touched">
            <small class="text-danger" [class.d-none]="lastName.valid || lastName.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
            <label for="experience">{{translate.user.doctorExperience}}</label>
            <textarea [(ngModel)]="doctor.experience" [pattern]="patterns.description" name="experience" id="experience" 
            class="form-control" rows="5" required #experience="ngModel" [class.is-invalid]="experience.invalid && experience.touched"></textarea>
            <small class="text-danger" [class.d-none]="experience.valid || experience.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
            <label for="country">{{translate.user.country}}</label>
            <input [(ngModel)]="doctor.country" [pattern]="patterns.name" type="text" name="country" id="country" 
            class="form-control form-control-sm" required #country="ngModel" [class.is-invalid]="country.invalid && country.touched">
            <small class="text-danger" [class.d-none]="country.valid || country.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
            <label for="zipCode">{{translate.user.zipCode}}</label>
            <input [(ngModel)]="doctor.zipCode" [pattern]="patterns.zipCode" type="text" name="zipCode" id="zipCode" 
            class="form-control form-control-sm" required #zipCode="ngModel" [class.is-invalid]="zipCode.invalid && zipCode.touched">
            <small class="text-danger" [class.d-none]="zipCode.valid || zipCode.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
            <label for="city">{{translate.user.city}}</label>
            <input [(ngModel)]="doctor.city" [pattern]="patterns.name" type="text" name="city" id="city" 
            class="form-control form-control-sm" required #city="ngModel" [class.is-invalid]="city.invalid && city.touched">
            <small class="text-danger" [class.d-none]="city.valid || city.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
            <label for="street">{{translate.user.street}}</label>
            <input [(ngModel)]="doctor.street" [pattern]="patterns.name" type="text" name="street" id="street" 
            class="form-control form-control-sm" required #street="ngModel" [class.is-invalid]="street.invalid && street.touched">
            <small class="text-danger" [class.d-none]="street.valid || street.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
            <label for="streetNo">{{translate.user.streetNo}}</label>
            <input [(ngModel)]="doctor.streetNo" [pattern]="patterns.smalName" type="text" name="streetNo" id="streetNo" 
            class="form-control form-control-sm" required #streetNo="ngModel" [class.is-invalid]="streetNo.invalid && streetNo.touched">
            <small class="text-danger" [class.d-none]="streetNo.valid || streetNo.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
            <label for="unitNo">{{translate.user.unitNo}}</label>
            <input [(ngModel)]="doctor.unitNo" [pattern]="patterns.smalNameFromZero" type="text" name="unitNo" id="unitNo" 
            class="form-control form-control-sm" #unitNo="ngModel" [class.is-invalid]="unitNo.invalid && unitNo.touched">
            <small class="text-danger" [class.d-none]="unitNo.valid || unitNo.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
            <label for="email">Email:</label>
            <input [(ngModel)]="doctor.user.email" [pattern]="patterns.email" type="email" 
            class="form-control form-control-sm" name="email" id="email" required #email="ngModel" 
            [class.is-invalid]="email.invalid && email.touched">
            <small class="text-danger" [class.d-none]="email.valid || email.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
            <label for="phone">{{translate.user.phone}}</label>
            <input [(ngModel)]="doctor.phone" [pattern]="patterns.phone" type="text" name="phone" id="phone" 
            class="form-control form-control-sm" required #phone="ngModel" [class.is-invalid]="phone.invalid && phone.touched">
            <small class="text-danger" [class.d-none]="phone.valid || phone.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
            <label for="pesel">Pesel:</label>
            <input [(ngModel)]="doctor.pesel" type="text" name="pesel" id="pesel" class="form-control form-control-sm" #pesel="ngModel" 
            [class.is-invalid]="!isValidPesel && pesel.touched" (change)="checkPesel(doctor.pesel)">
            <small class="text-danger" [class.d-none]="isValidPesel || pesel.untouched">{{translate.error.requiredField}}</small>
        </div>
        <div class="form-group">
          <label for="language">{{translate.user.language}}</label>
          <select [(ngModel)]="doctor.user.language" class="form-control form-control-sm" name="language" id="language"
            #language="ngModel" [class.is-invalid]="language.value === languageCodeList[0]">
            <option *ngFor="let lang of languageCodeList" [ngValue]="lang">
              {{lang}}
            </option>
          </select>
          <small id="language" class="text-danger"
            [class.d-none]="language.value != languageCodeList[0]">{{translate.error.language}}</small>
        </div>
        <div class="form-group">
          <button type="button" (click)="deletePhoto()" [disabled]="!doctor.user.photo"
          class="btn btn-outline-secondary">{{translate.button.deletePhoto}}</button>
        </div>
        <figure class="figure">
            <img [src]="user_photo ? user_photo : 'assets/img/alterphoto.jpeg'" style="height: 200px;" 
            class="figure-img img-fluid rounded" alt="Image">
            <figcaption class="figure-caption text-xs-right"></figcaption>
            <small class="text-danger" [class.d-none]="compressedFileSize <= patterns.maxCompressedFileSize">
              {{translate.error.compressedPhotoSize +': '+patterns.maxCompressedFileSize}}</small>
            <small class="text-danger" [class.d-none]="oryginalFileSize <= patterns.maxOryginalFileSize">
              {{translate.error.oryginalPhotoSize +': '+patterns.maxOryginalFileSize}}</small>
        </figure>
        <div class="form-group">
            <input type="file" name="image" class="form-control form-control-sm" #fileInput style="display: none;" accept="image/*"
            (change)="onFileSelect($event)">
            <button type="button" (click)="fileInput.click()" id="image" class="btn btn-outline-secondary">{{translate.user.image}}</button>
        </div>
        <div class="table-responsive" *ngIf="fileAttachment">
            <table class="table table-striped">
                <thead class="thead-light">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">{{translate.home.fileName}}</th>
                        <th scope="col">{{translate.home.fileType}}</th>
                        <th scope="col">{{translate.home.fileSize}}</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">1</th>
                        <td>{{fileAttachment.fileName}}</td>
                        <td>{{fileAttachment.fileType}}</td>
                        <td>{{fileAttachment.fileSize}}</td>
                        <td><button type="button" (click)="onClearFileAttachment()" id="file" 
                            class="btn btn-outline-secondary">{{translate.button.delete}}</button></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="form-group">
            <label for="registerDateTime">{{translate.user.registerDateTime}}</label>
            <input [value]="doctor.registerDateTime | date:'yyyy-MM-dd HH:mm'" type="text" name="registerDateTime" id="registerDateTime" 
            class="form-control form-control-sm" disabled>
        </div>
        <div class="form-group">
            <label for="editDateTime">{{translate.user.editDateTime}}</label>
            <input [value]="doctor.editDateTime | date:'yyyy-MM-dd HH:mm'" type="text" name="editDateTime" id="editDateTime" 
            class="form-control form-control-sm" disabled>
        </div>
        <div class="form-group">
            <input [disabled]="selfUpdateForm.form.invalid || language.value === languageCodeList[0] || !isValidPesel ||
            password1.value !== password2.value || compressedFileSize > patterns.maxCompressedFileSize || 
            oryginalFileSize > patterns.maxOryginalFileSize"
            class="btn btn-primary" type="submit" value="{{translate.button.save}}">
        </div>
    </form>
    
    <div id="server_answer">
        <div class="alert alert-success alert-dismissible" *ngIf="answer.serverAnswer === 'UPDATED'">
            <button type="button" class="close" data-dismiss="alert" (click)="onCorrectUpdate()">OK</button>
            <strong>{{answer.subject}}</strong> {{answer.message}}
        </div>
        <div class="alert alert-danger alert-dismissible" *ngIf="answer.serverAnswer === 'NOTUNIQUE' || answer.serverAnswer === 'INVALID'">
            <button type="button" class="close" data-dismiss="alert" (click)="answer.serverAnswer = null">OK</button>
            <strong>{{answer.subject}}</strong> {{answer.message}}
        </div>
        <div class="alert alert-danger alert-dismissible" *ngIf="answer.errorStatus >= 0">
            <button type="button" class="close" data-dismiss="alert" (click)="answer.errorStatus = -1">OK</button>
            <strong>{{answer.subject}}</strong> {{answer.message}}
        </div>
    </div>

</div>
